---
phase: quick-02
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - offchain/src/app/api/route-job/route.ts
  - offchain/src/app/verify-agent/page.tsx
autonomous: true
requirements: ["QUICK-02-AGENT-E2E"]
gap_closure: true

must_haves:
  truths:
    - "User can fill in job requirements and submit to the agent from the browser"
    - "Agent fetches Akash providers, filters, ranks, and returns a result"
    - "Thinking steps display in real-time as the agent processes"
    - "Result card shows selected provider with reasoning, cost, and confidence"
  artifacts:
    - path: "offchain/src/app/api/route-job/route.ts"
      provides: "Server-side API route invoking routeComputeJob"
      exports: ["POST"]
    - path: "offchain/src/app/verify-agent/page.tsx"
      provides: "Job submission form + thinking steps + result display"
      min_lines: 100
  key_links:
    - from: "offchain/src/app/verify-agent/page.tsx"
      to: "/api/route-job"
      via: "fetch POST from form submit handler"
      pattern: "fetch.*api/route-job"
    - from: "offchain/src/app/api/route-job/route.ts"
      to: "offchain/src/lib/agent/agent.ts"
      via: "import routeComputeJob"
      pattern: "routeComputeJob"
---

<objective>
Close the gap: the Google ADK agent module is complete but has zero frontend integration. Add an API route to invoke the agent server-side and rebuild the verify-agent page to be a job submission + agent demo UI.

Purpose: Prove the agent works end-to-end from the browser — user submits job requirements, agent fetches/filters/ranks Akash providers, thinking steps stream to UI, result displayed.

Output: Working /verify-agent page that invokes the agent via /api/route-job API route.
</objective>

<execution_context>
@/home/julius/.claude/get-shit-done/workflows/execute-plan.md
@/home/julius/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@offchain/src/lib/agent/agent.ts
@offchain/src/lib/agent/types.ts
@offchain/src/lib/agent/wallet-tool.ts
@offchain/src/lib/providers/akash-fetcher.ts
@offchain/src/app/verify-agent/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /api/route-job server-side API route</name>
  <files>offchain/src/app/api/route-job/route.ts</files>
  <action>
Create a Next.js API route at app/api/route-job/route.ts that:

1. Exports a POST handler accepting JSON body with shape:
   ```ts
   {
     description: string
     requirements: {
       gpuModel?: string
       minGpuCount?: number
       maxPricePerHour?: number
       region?: string
     }
     isTracked: boolean
     userAddress: string // hex address
   }
   ```

2. Imports `routeComputeJob` from `@/lib/agent/agent` and `AgentConfig` from `@/lib/agent/types`.

3. Creates an AgentConfig using:
   - `apiKey: process.env.GOOGLE_AI_STUDIO_API_KEY || ''`
   - `model: 'gemini-2.0-flash'`
   - `name: 'necto-router'`

4. Calls `routeComputeJob(request, config, onThinking)` where onThinking collects ThinkingStep[] into an array.

5. Returns JSON response:
   - On success (200): `{ success: true, result: RoutingResult, thinkingSteps: ThinkingStep[], transaction?: TransactionResult }`
   - On error (500): `{ success: false, error: string }`

6. Do NOT require GOOGLE_AI_STUDIO_API_KEY to be present — the agent's routeComputeJob function does not actually call the LLM (it uses its own filter/rank logic). The API key is only needed for createRoutingAgent which we are NOT calling in this route. The route should work without the key.

7. Do NOT require AGENT_PRIVATE_KEY for non-tracked jobs. Only tracked jobs (isTracked=true) need it for blockchain submission. For the demo, default isTracked to false if not provided.

8. Validate the request body — return 400 if description is missing.

9. Use NextResponse from 'next/server'.
  </action>
  <verify>
Run `cd /home/julius/Documents/necto/offchain && npx tsc --noEmit offchain/src/app/api/route-job/route.ts` or the project-level build check. Confirm no type errors.
  </verify>
  <done>POST /api/route-job accepts job requirements, invokes routeComputeJob, returns result with thinking steps. Works without API keys for untracked jobs.</done>
</task>

<task type="auto">
  <name>Task 2: Rebuild verify-agent page as agent demo UI</name>
  <files>offchain/src/app/verify-agent/page.tsx</files>
  <action>
Replace the current verify-agent page (which only tests contract reads/writes) with an agent demo page. Keep the existing wallet/contract verification section but ADD agent invocation as the primary feature.

The page should have these sections:

**A) Header** — "Agent Router Demo" title with brief description.

**B) Job Submission Form** — A Card with:
- Text input for "Job Description" (e.g., "Train a BERT model on custom dataset")
- Select dropdown for GPU Model preference: "Any", "A100", "H100", "RTX4090", "RTX3090", "V100" (use the existing shadcn Select component from @/components/ui/select)
- Number input for "Max Price ($/hr)" with placeholder "e.g. 3.00"
- Number input for "Min GPU Count" with placeholder "e.g. 1"
- Input for "Region" with placeholder "e.g. US" (optional)
- A "Route Job" Button that triggers the API call
- Disable the button while loading, show Loader2 spinner

**C) Thinking Steps Display** — Below the form, show a live-updating list of thinking steps:
- Each step shows: status icon (Loader2 spinning for active, CheckCircle for complete, XCircle for error), message text, and timestamp
- Steps appear one by one as they come back from the API response
- Use a simple sequential reveal animation: after API returns, display steps one at a time with 500ms delay between each using setTimeout
- Style: vertical timeline look using a left border (border-l-2) with dots

**D) Result Card** — When routing completes, show:
- Selected provider name, source, region
- Hardware details: GPU model, GPU count
- Price estimate per hour
- Uptime percentage
- Agent reasoning text
- Confidence score as a percentage
- All in a Card with green border on success

**E) Error Display** — If the API returns an error, show it in a destructive Alert.

**Implementation details:**
- "use client" directive at top
- State: formData (description, gpuModel, maxPrice, minGpuCount, region), thinkingSteps[], result (RoutingResult | null), isLoading, error
- On submit: POST to /api/route-job with the form data, parse response, animate thinking steps display, then show result
- Use existing shadcn components: Card, Button, Input, Select, Alert, Badge, Separator
- Use lucide-react icons: Brain, Cpu, DollarSign, MapPin, Loader2, CheckCircle, XCircle, Zap, Activity
- Keep the cyberpunk/terminal aesthetic — dark themed, use terminal-data class for monospace numbers
- The wallet connection section from the old page can be kept at the BOTTOM as a collapsible "Advanced: Contract Verification" section, but it's not the focus. If keeping it makes the file too large (>300 lines of JSX), simplify or remove it.
- Do NOT pass userAddress as required — use a dummy "0x0000000000000000000000000000000000000000" if wallet not connected, since untracked jobs don't need a real address
- Set isTracked to false always for this demo page
  </action>
  <verify>
Run `cd /home/julius/Documents/necto/offchain && npm run build` to confirm no build errors. Then run `npm run dev` and visit http://localhost:3000/verify-agent — confirm the form renders, fill in "Train BERT model" with GPU "Any" and max price 5, click Route Job, and verify thinking steps appear followed by a result card with a real Akash provider.
  </verify>
  <done>The /verify-agent page shows a job submission form. Clicking "Route Job" calls the API, displays thinking steps progressively, and shows the selected provider with reasoning. The agent works end-to-end from the browser.</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors in offchain/
2. Visit http://localhost:3000/verify-agent — form loads correctly
3. Submit a job with description "Train BERT model", GPU "Any", max price $5 — API returns result
4. Thinking steps display sequentially (fetching providers, filtering, ranking, decision ready)
5. Result card shows a real Akash provider with name, GPU, price, uptime, reasoning
</verification>

<success_criteria>
- POST /api/route-job returns 200 with routing result and thinking steps for valid input
- /verify-agent page has job submission form with all requirement fields
- Thinking steps render progressively after submission
- Result card displays selected provider details and agent reasoning
- No API keys required for untracked demo flow
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/quick/2-create-google-adk-agent-with-google-ai-s/02-03-SUMMARY.md`
</output>
