---
phase: 02-akash-webapp-deploy
plan: 01
title: Akash Integration - Deployment Routing
subsystem: offchain
author: Necto Team
date: 2026-02-17
tags: [akash, deployment, sdl, keplr, marketplace]

# Dependency graph
requires:
  - phase: 01-foundation-core-agent
    provides: [typescript-monorepo, viem, wagmi, component-library, agent]
provides:
  - Akash API client module
  - SDL generator service
  - Template gallery UI
  - Deployment routing capability
  - Keplr wallet integration
  - Provider discovery for Akash
affects:
  - marketplace-buyer-experience
  - agent-routing-capability
  - akash-provider-integration

# Context
current_state: |
  Project foundation complete with ComputeRouter contract and Google ADK agent.
  Now adding Akash as the first provider integration for the marketplace.

target_state: |
  Buyers can submit jobs and have them routed to Akash providers for deployment.
  Agent can recommend Akash providers and generate SDL for deployments.

# Technical context
tech_stack:
  - nextjs-16
  - react-19
  - typescript
  - tailwind-v4
  - shadcn-ui
  - akash-api
  - keplr-wallet
  - google-adk
---

# Phase 02 Plan 01: Akash Integration - Deployment Routing

## Goal
Build Akash integration that allows the marketplace agent to route compute jobs to Akash Network providers. This adds Akash as the first supported provider in the two-sided marketplace.

## Success Criteria

1. [ ] Buyer can submit a job and have it routed to an Akash provider
2. [ ] Agent can discover and recommend Akash providers
3. [ ] SDL is generated correctly for job requirements
4. [ ] Keplr wallet integration works for AKT transactions
5. [ ] Deployment status can be monitored in real-time
6. [ ] Job records include Akash deployment details

## Requirements Mapping

| Requirement | Description | Priority |
|-------------|-------------|----------|
| AKA-01 | Akash API client for provider discovery | High |
| AKA-02 | SDL generator for job requirements | High |
| AKA-03 | Template gallery for common workloads | Medium |
| AKA-04 | Deployment routing to Akash providers | High |
| AKA-05 | Real-time deployment monitoring | Medium |
| AKA-06 | Keplr wallet integration | High |
| PROV-01 | Akash provider discovery with filters | High |
| MRK-01 | Job submission includes Akash option | High |

## Technical Design

### 1. Akash API Client Module

**Location:** `offchain/src/lib/akash/`

**Components:**
- `client.ts` - Axios/fetch wrapper for Akash Console API
- `types.ts` - TypeScript interfaces for API responses
- `providers.ts` - Provider discovery and filtering
- `deployment.ts` - Deployment operations

**Key Endpoints:**
```typescript
// Provider discovery
GET /v1/providers - List all providers
GET /v1/providers/{address} - Provider details

// Deployment management
POST /v1/deployments - Create deployment
GET /v1/deployments/{dseq} - Get deployment status
DELETE /v1/deployments/{dseq} - Close deployment
GET /v1/deployments/{dseq}/logs - Fetch logs
```

### 2. SDL Generator Service

**Location:** `offchain/src/lib/akash/sdl-generator.ts`

**Function:** Convert job requirements to Akash SDL YAML

**Input:** Job requirements (CPU, memory, GPU, image, env vars)
**Output:** Valid Akash SDL document

**Templates:**
- ML Training (GPU-enabled)
- Web Service (Node.js/Python)
- Static Site (nginx)
- Custom Docker Image

### 3. Agent Integration

**Location:** `offchain/src/lib/agent/akash-routing.ts`

**Function:** Extend agent to route jobs to Akash

**Integration Points:**
- Agent queries Akash providers via API
- Agent normalizes Akash pricing (AKT/USD)
- Agent generates SDL for selected provider
- Agent submits deployment via wallet

### 4. Job Submission Enhancement

**Location:** `offchain/src/components/job/JobSubmissionForm.tsx`

**New Options:**
- "Deploy to Akash" toggle
- Template selection (if applicable)
- Provider preference (auto/manual)

### 5. Wallet Integration

**Location:** `offchain/src/lib/wallet/keplr.ts`

**Features:**
- Detect Keplr extension
- Connect to Akash network (chain-id: akashnet-2)
- Sign deployment transactions
- Query AKT balance

### 6. Provider Discovery UI

**Location:** `offchain/src/components/providers/AkashProviderList.tsx`

**Features:**
- List Akash providers with specs and pricing
- Filter by region, price, availability
- Show in agent recommendations

## Implementation Tasks

### Task 1: Set Up Akash API Infrastructure
**Estimated:** 30 minutes

- [ ] Install dependencies (axios, @cosmjs/*)
- [ ] Create `offchain/src/lib/akash/client.ts`
- [ ] Define TypeScript types for API
- [ ] Test connection to Akash Console API
- [ ] Commit: `feat(akash): set up API client and types`

### Task 2: Create SDL Generator
**Estimated:** 45 minutes

- [ ] Create `offchain/src/lib/akash/sdl-generator.ts`
- [ ] Implement templates for common workloads
- [ ] Add resource calculator
- [ ] Create SDL validation
- [ ] Write unit tests
- [ ] Commit: `feat(akash): add SDL generator`

### Task 3: Integrate Akash into Agent
**Estimated:** 60 minutes

- [ ] Create `offchain/src/lib/agent/akash-routing.ts`
- [ ] Add Akash provider discovery to agent
- [ ] Implement pricing normalization (AKT/USD)
- [ ] Add SDL generation to agent workflow
- [ ] Update agent types
- [ ] Commit: `feat(agent): add Akash provider routing`

### Task 4: Build Provider Discovery UI
**Estimated:** 45 minutes

- [ ] Create `AkashProviderList` component
- [ ] Add provider filtering
- [ ] Show pricing in normalized USD
- [ ] Integrate with agent recommendations
- [ ] Commit: `feat(ui): add Akash provider discovery`

### Task 5: Implement Keplr Wallet Integration
**Estimated:** 45 minutes

- [ ] Create `offchain/src/lib/wallet/keplr.ts`
- [ ] Add wallet connection button
- [ ] Implement transaction signing
- [ ] Handle connection errors
- [ ] Commit: `feat(wallet): add Keplr integration`

### Task 6: Create Deployment API Routes
**Estimated:** 60 minutes

- [ ] `POST /api/deployments` - Create Akash deployment
- [ ] `GET /api/deployments/[id]` - Get deployment status
- [ ] `GET /api/deployments/[id]/logs` - Fetch logs
- [ ] Integrate with job registry
- [ ] Commit: `feat(api): add Akash deployment routes`

### Task 7: Enhance Job Submission Form
**Estimated:** 45 minutes

- [ ] Add "Deploy to Akash" option
- [ ] Create template selection UI
- [ ] Add provider preference toggle
- [ ] Update form validation
- [ ] Commit: `feat(ui): enhance job submission with Akash`

### Task 8: Testing & Integration
**Estimated:** 60 minutes

- [ ] Test end-to-end job → Akash flow
- [ ] Verify agent recommendations
- [ ] Test wallet transactions
- [ ] Test error scenarios
- [ ] Commit: `test: Akash integration end-to-end`

## File Structure

```
offchain/src/
├── app/
│   └── api/
│       └── deployments/
│           ├── route.ts
│           └── [id]/
│               ├── route.ts
│               └── logs/
│                   └── route.ts
├── components/
│   ├── job/
│   │   └── JobSubmissionForm.tsx
│   └── providers/
│       └── AkashProviderList.tsx
├── lib/
│   ├── akash/
│   │   ├── client.ts
│   │   ├── types.ts
│   │   ├── sdl-generator.ts
│   │   └── providers.ts
│   ├── agent/
│   │   ├── akash-routing.ts
│   │   └── types.ts (update)
│   └── wallet/
│       └── keplr.ts
└── types/
    └── akash.ts
```

## Testing Strategy

### Unit Tests
- SDL generator with various inputs
- Provider discovery filtering
- Wallet connection helpers
- Pricing normalization

### Integration Tests
- End-to-end job → Akash deployment
- Agent routing decisions
- Wallet transaction signing

### Manual Testing
- Deploy test jobs to Akash
- Verify provider discovery
- Test error scenarios
- Check job registry updates

## Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| Keplr not installed | High | Provide install instructions |
| SDL generation errors | High | Validate before submit |
| API rate limits | Medium | Implement caching |
| AKT balance insufficient | Medium | Check balance before deploy |
| Agent routing incorrect | High | Test with known providers |

## Definition of Done

- [ ] All 8 tasks complete and committed
- [ ] All success criteria met
- [ ] Buyer can submit job → agent routes → deploys to Akash
- [ ] Job records include Akash deployment details
- [ ] Code passes lint check
- [ ] Documentation updated

## Integration with Marketplace

### Job Flow
```
Buyer submits job
    ↓
Agent queries providers (including Akash)
    ↓
Agent normalizes pricing
    ↓
Agent recommends Akash provider (if suitable)
    ↓
Buyer confirms (or agent auto-signs)
    ↓
SDL generated for job requirements
    ↓
Deployment created on Akash
    ↓
Job record updated with deployment details
    ↓
Buyer monitors deployment status
```

### Future Extensions
- Add more providers (io.net, Lambda Labs, etc.)
- Cross-provider price comparison
- Provider reputation scoring
- Advanced routing algorithms

---

*Plan created: February 17, 2026*  
*Phase: 02-akash-integration*  
*Plan: 01*  
*Part of: Two-sided compute marketplace*
